<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Intro</title>
    <link rel="stylesheet" href="style.css?v=6" />
    <style>
      /* ===== Loader ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Intro ===== */
      .intro-loader {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: 24px;
        z-index: 5;
        width: min(420px, 86%);
        background: rgba(0, 0, 0, 0.45);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 14px;
        padding: 10px 12px;
        color: #fff;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
        text-align: center;
      }
      .intro-title {
        font-weight: 700;
        font-size: 0.95rem;
        margin-bottom: 8px;
      }
      .intro-progress {
        height: 10px;
        border-radius: 999px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.15);
      }
      .intro-progress .intro-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #a0e3ff, #5fd4ff);
        transition: width 0.08s linear;
      }
      .intro-percent {
        margin-top: 6px;
        font-weight: 800;
        letter-spacing: 0.5px;
      }
      body.leaving .intro-loader {
        opacity: 0;
        transition: opacity 0.35s ease;
      }

      /* ===== Welcome Overlay ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ ===== */
      .welcome-overlay {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        z-index: 6;
        pointer-events: none;
        opacity: 0;
        transform: scale(0.96);
        transition: opacity 0.35s ease, transform 0.35s ease;
      }
      .welcome-overlay::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(transparent 40%, rgba(0, 0, 0, 0.45));
        opacity: 0;
        transition: opacity 0.35s ease;
      }
      .welcome-box {
        padding: 22px 28px;
        border-radius: 18px;
        background: rgba(0, 0, 0, 0.55);
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        color: #fff;
        text-align: center;
        backdrop-filter: blur(6px);
      }
      .welcome-box h2 {
        margin: 0;
        font-size: clamp(1.6rem, 3.2vw, 2.4rem);
        letter-spacing: 0.5px;
        text-shadow: 0 6px 24px rgba(0, 0, 0, 0.5);
      }
      .welcome-overlay.show {
        opacity: 1;
        transform: scale(1);
      }
      .welcome-overlay.show::before {
        opacity: 1;
      }
      body.leaving .welcome-overlay {
        opacity: 0;
      }

      /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡πá‡∏Å */
      .mini-logout {
        margin-top: 12px;
        padding: 8px 14px;
        border-radius: 999px;
        border: 0;
        background: rgba(255, 255, 255, 0.85);
        cursor: pointer;
        font-weight: 600;
      }

      /* ===== ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á ===== */
      .sound-toggle {
        position: absolute;
        right: 16px;
        top: 16px;
        z-index: 7;
        padding: 8px 10px;
        border: 0;
        border-radius: 999px;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.55);
        color: #fff;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ -->
    <section id="intro">
      <video
        id="introVideo"
        autoplay
        muted
        playsinline
        preload="auto"
        poster="images/logo.jpg"
      >
        <!-- ‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà /videos/Logo.mp4 (‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏•‡πá‡∏Å) -->
        <source src="videos/Logo.mp4?v=6" type="video/mp4" />
        ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ HTML5
      </video>

      <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏±‡∏ö‡∏ö‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ -->
      <div class="center-overlay">
        <img src="images/logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" class="logo" />

        <button class="mini-logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
      <button
        id="soundBtn"
        class="sound-toggle"
        aria-pressed="false"
        title="‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á"
      >
        üîá
      </button>

      <!-- Welcome ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ % ‡πÉ‡∏Å‡∏•‡πâ 100) -->
      <div id="welcome" class="welcome-overlay" aria-hidden="true">
        <div class="welcome-box"><h2 id="welcomeText">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2></div>
      </div>

      <!-- Loader % ‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ -->
      <div class="intro-loader" id="introLoader" aria-live="polite">
        <div class="intro-title">‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DATA</div>
        <div class="intro-progress">
          <div class="intro-bar" id="introBar"></div>
        </div>
        <div class="intro-percent"><span id="introPct">0</span>%</div>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏° -->
      <button id="skipBtn" class="skip">‡∏Ç‡πâ‡∏≤‡∏° ‚ñ∂</button>
    </section>

    <script>
      // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ
      (function guard() {
        try {
          const auth = JSON.parse(localStorage.getItem("app_auth") || "{}");
          if (!auth.loggedIn) location.replace("index.html");
        } catch {
          location.replace("index.html");
        }
      })();

      function logout() {
        localStorage.removeItem("app_auth");
        location.href = "index.html";
      }

      const video = document.getElementById("introVideo");
      const skipBtn = document.getElementById("skipBtn");
      const pctEl = document.getElementById("introPct");
      const barEl = document.getElementById("introBar");
      const welcome = document.getElementById("welcome");
      const welcomeText = document.getElementById("welcomeText");
      const soundBtn = document.getElementById("soundBtn");

      // ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö" ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      try {
        const auth = JSON.parse(localStorage.getItem("app_auth") || "{}");
        if (auth && auth.name)
          welcomeText.textContent = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ${auth.name}`;
      } catch {}

      const NEXT_PAGE = "next.html";
      let jumped = false;
      let welcomeShown = false;
      let simTimer = null;

      function setProgress(p) {
        const v = Math.max(0, Math.min(100, p));
        pctEl.textContent = Math.floor(v);
        barEl.style.width = v + "%";
        if (!welcomeShown && v >= 92) {
          welcome.classList.add("show");
          welcomeShown = true;
        }
      }

      const jump = () => {
        if (jumped) return;
        jumped = true;
        setProgress(100);
        document.body.classList.add("leaving");
        setTimeout(() => {
          window.location.href = NEXT_PAGE;
        }, 350);
      };

      // ====== Progress ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ======
      video.addEventListener("loadedmetadata", () => {
        if (isFinite(video.duration) && video.duration > 0) {
          video.addEventListener("timeupdate", () => {
            if (!isFinite(video.duration)) return;
            const p = (video.currentTime / video.duration) * 100;
            setProgress(p);
            if (video.currentTime >= video.duration - 0.2) jump();
          });
        } else {
          startSimulatedProgress();
        }
      });

      video.addEventListener("ended", jump);
      skipBtn.addEventListener("click", jump);

      // ====== ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á & ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ autoplay ======
      // ‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö autoplay ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô "muted"
      // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°/‡πÅ‡∏ï‡∏∞‡∏à‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
      document.addEventListener(
        "click",
        async () => {
          if (video.paused) {
            try {
              await video.play();
            } catch (e) {}
          }
        },
        { once: true }
      );

      soundBtn.addEventListener("click", async () => {
        try {
          await video.play();
        } catch (e) {}
        video.muted = !video.muted; // toggle mute
        soundBtn.textContent = video.muted ? "üîá" : "üîä";
        soundBtn.setAttribute("aria-pressed", (!video.muted).toString());
      });

      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á" ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
      function hasAudioTrack(v) {
        try {
          if (typeof v.mozHasAudio !== "undefined") return v.mozHasAudio; // Firefox
          if (typeof v.webkitAudioDecodedByteCount !== "undefined")
            // Safari/‡πÄ‡∏Å‡πà‡∏≤‡πÜ
            return v.webkitAudioDecodedByteCount > 0;
          if (v.audioTracks && v.audioTracks.length) return true; // Chrome ‡∏ö‡∏≤‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
        } catch {}
        return false;
      }
      video.addEventListener("loadeddata", () => {
        if (!hasAudioTrack(video)) soundBtn.style.display = "none";
      });

      // ‡∏Å‡∏±‡∏ô‡∏à‡∏≠‡∏î‡∏≥‡∏Å‡∏£‡∏ì‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ä‡πâ‡∏≤‡∏°‡∏≤‡∏Å
      setTimeout(() => {
        if (!jumped && video.currentTime === 0) jump();
      }, 12000);

      // ====== ‡∏à‡∏≥‡∏•‡∏≠‡∏á % ‡∏´‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô duration ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ======
      function startSimulatedProgress() {
        let p = 0;
        if (simTimer) cancelAnimationFrame(simTimer);
        const tick = () => {
          const inc =
            p < 80
              ? Math.random() * 2 + 1.2
              : p < 97
              ? Math.random() * 1 + 0.4
              : 0.2;
          p = Math.min(100, p + inc);
          setProgress(p);
          if (!jumped && p < 100) {
            simTimer = requestAnimationFrame(tick);
          } else if (!jumped) {
            jump();
          }
        };
        simTimer = requestAnimationFrame(tick);
      }
    </script>
  </body>
</html>
